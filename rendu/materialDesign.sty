% Requirement
\RequirePackage{tikz}
\RequirePackage{xcolor}
\RequirePackage{ifthen}
\RequirePackage[many]{tcolorbox}
\RequirePackage{graphicx}
\RequirePackage[a-1b]{pdfx}
\RequirePackage{hyperref}

% Light theme
\newcommand{\useLightTheme}{
    \definecolor{text}{HTML}{000000}
    %\color*{normal text}{fg=text}
    \definecolor{shadow}{HTML}{000000}
    \definecolor{BGgrey01}{HTML}{E0E0E0}
    \definecolor{BGgrey02}{HTML}{F5F5F5}
    \definecolor{BGgrey03}{HTML}{FAFAFA}
    \definecolor{BGgrey04}{HTML}{FFFFFF}
}

% Dark theme
\newcommand{\useDarkTheme}{
    \definecolor{text}{HTML}{FFFFFF}
    %\color*{normal text}{fg=text}
    \definecolor{shadow}{HTML}{000000}
    \definecolor{BGgrey01}{HTML}{000000}
    \definecolor{BGgrey02}{HTML}{212121}
    \definecolor{BGgrey03}{HTML}{303030}
    \definecolor{BGgrey04}{HTML}{424242}
}

% PRIMARY --------------------------------------------------------------
\newcommand{\usePrimary}[3]{
    \definecolor{primary}{HTML}{#1}
    \definecolor{primaryD}{HTML}{#2}
    \definecolor{textPrimary}{HTML}{#3}
}

% Primary Red
\newcommand{\usePrimaryRed}{
    \definecolor{primary}{HTML}{F44336}
    \definecolor{primaryD}{HTML}{D32F2F}
    \definecolor{textPrimary}{HTML}{FFFFFF}
}

% Primary Pink
\newcommand{\usePrimaryPink}{
    \definecolor{primary}{HTML}{E91E63}
    \definecolor{primaryD}{HTML}{C2185B}
    \definecolor{textPrimary}{HTML}{FFFFFF}
}

% Primary Purple
\newcommand{\usePrimaryPurple}{
    \definecolor{primary}{HTML}{6A1B9A}
    \definecolor{primaryD}{HTML}{7B1FA2}
    \definecolor{textPrimary}{HTML}{FFFFFF}
}

% Primary Deep Purple
\newcommand{\usePrimaryDeepPurple}{
    \definecolor{primary}{HTML}{673AB7}
    \definecolor{primaryD}{HTML}{512DA8}
    \definecolor{textPrimary}{HTML}{FFFFFF}
}

% Primary Indigo
\newcommand{\usePrimaryIndigo}{
    \definecolor{primary}{HTML}{3F51B5}
    \definecolor{primaryD}{HTML}{303F9F}
    \definecolor{textPrimary}{HTML}{FFFFFF}
}

% Primary Blue
\newcommand{\usePrimaryBlue}{
    \definecolor{primary}{HTML}{2196F3}
    \definecolor{primaryD}{HTML}{1976D2}
    \definecolor{textPrimary}{HTML}{FFFFFF}
}

% Primary Light Blue
\newcommand{\usePrimaryLightBlue}{
    \definecolor{primary}{HTML}{03A9F4}
    \definecolor{primaryD}{HTML}{0288D1}
    \definecolor{textPrimary}{HTML}{000000}
}

% Primary Cyan
\newcommand{\usePrimaryCyan}{
    \definecolor{primary}{HTML}{00BCD4}
    \definecolor{primaryD}{HTML}{0097A7}
    \definecolor{textPrimary}{HTML}{000000}
}

% Primary Teal
\newcommand{\usePrimaryTeal}{
    \definecolor{primary}{HTML}{009688}
    \definecolor{primaryD}{HTML}{00796B}
    \definecolor{textPrimary}{HTML}{FFFFFF}
}

% Primary Green
\newcommand{\usePrimaryGreen}{
    \definecolor{primary}{HTML}{4CAF50}
    \definecolor{primaryD}{HTML}{388E3C}
    \definecolor{textPrimary}{HTML}{FFFFFF}
}

% Primary Light Green
\newcommand{\usePrimaryLightGreen}{
    \definecolor{primary}{HTML}{8BC34A}
    \definecolor{primaryD}{HTML}{689F38}
    \definecolor{textPrimary}{HTML}{000000}
}

% Primary Lime
\newcommand{\usePrimaryLime}{
    \definecolor{primary}{HTML}{CDDC39}
    \definecolor{primaryD}{HTML}{AFB42B}
    \definecolor{textPrimary}{HTML}{000000}
}

% Primary Yellow
\newcommand{\usePrimaryYellow}{
    \definecolor{primary}{HTML}{FFEB3B}
    \definecolor{primaryD}{HTML}{FBC02D}
    \definecolor{textPrimary}{HTML}{000000}
}

% Primary Amber
\newcommand{\usePrimaryAmber}{
    \definecolor{primary}{HTML}{FFC107}
    \definecolor{primaryD}{HTML}{FFA000}
    \definecolor{textPrimary}{HTML}{000000}
}

% Primary Orange
\newcommand{\usePrimaryOrange}{
    \definecolor{primary}{HTML}{FF9800}
    \definecolor{primaryD}{HTML}{F57C00}
    \definecolor{textPrimary}{HTML}{000000}
}

% Primary Deep Orange
\newcommand{\usePrimaryDeepOrange}{
    \definecolor{primary}{HTML}{FF5722}
    \definecolor{primaryD}{HTML}{E64A19}
    \definecolor{textPrimary}{HTML}{FFFFFF}
}

% Primary Brown
\newcommand{\usePrimaryBrown}{
    \definecolor{primary}{HTML}{795548}
    \definecolor{primaryD}{HTML}{5D4037}
    \definecolor{textPrimary}{HTML}{FFFFFF}
}

% Primary Grey
\newcommand{\usePrimaryGrey}{
    \definecolor{primary}{HTML}{9E9E9E}
    \definecolor{primaryD}{HTML}{616161}
    \definecolor{textPrimary}{HTML}{000000}
}

% Primary Blue Grey
\newcommand{\usePrimaryBlueGrey}{
    \definecolor{primary}{HTML}{607D8B}
    \definecolor{primaryD}{HTML}{455A64}
    \definecolor{textPrimary}{HTML}{FFFFFF}
}

% ACCENT ---------------------------------------------------------------

\newcommand{\useAccent}[2]{
    \definecolor{accent}{HTML}{#1}
    \definecolor{textAccent}{HTML}{#2}
}

% Accent Red
\newcommand{\useAccentRed}{
    \definecolor{accent}{HTML}{FF1744}
    \definecolor{textAccent}{HTML}{FFFFFF}
}

% Accent Pink
\newcommand{\useAccentPink}{
    \definecolor{accent}{HTML}{F50057}
    \definecolor{textAccent}{HTML}{FFFFFF}
}

% Accent Purple
\newcommand{\useAccentPurple}{
    \definecolor{accent}{HTML}{D500F9}
    \definecolor{textAccent}{HTML}{FFFFFF}
}

% Accent Deep Purple
\newcommand{\useAccentDeepPurple}{
    \definecolor{accent}{HTML}{651FFF}
    \definecolor{textAccent}{HTML}{FFFFFF}
}

% Accent Indigo
\newcommand{\useAccentIndigo}{
    \definecolor{accent}{HTML}{3D5AFE}
    \definecolor{textAccent}{HTML}{FFFFFF}
}

% Accent Blue
\newcommand{\useAccentBlue}{
    \definecolor{accent}{HTML}{2979FF}
    \definecolor{textAccent}{HTML}{FFFFFF}
}

% Accent Light Blue
\newcommand{\useAccentLightBlue}{
    \definecolor{accent}{HTML}{00B0FF}
    \definecolor{textAccent}{HTML}{000000}
}

% Accent Cyan
\newcommand{\useAccentCyan}{
    \definecolor{accent}{HTML}{00E5FF}
    \definecolor{textAccent}{HTML}{000000}
}

% Accent Teal
\newcommand{\useAccentTeal}{
    \definecolor{accent}{HTML}{1DE9B6}
    \definecolor{textAccent}{HTML}{000000}
}

% Accent Green
\newcommand{\useAccentGreen}{
    \definecolor{accent}{HTML}{00E676}
    \definecolor{textAccent}{HTML}{000000}
}

% Accent Light Green
\newcommand{\useAccentLightGreen}{
    \definecolor{accent}{HTML}{76FF03}
    \definecolor{textAccent}{HTML}{000000}
}

% Accent Lime
\newcommand{\useAccentLime}{
    \definecolor{accent}{HTML}{C6FF00}
    \definecolor{textAccent}{HTML}{000000}
}

% Accent Yellow
\newcommand{\useAccentYellow}{
    \definecolor{accent}{HTML}{FFEA00}
    \definecolor{textAccent}{HTML}{000000}
}

% Accent Amber
\newcommand{\useAccentAmber}{
    \definecolor{accent}{HTML}{FFC400}
    \definecolor{textAccent}{HTML}{000000}
}

% Accent Orange
\newcommand{\useAccentOrange}{
    \definecolor{accent}{HTML}{FF9100}
    \definecolor{textAccent}{HTML}{000000}
}

% Accent Deep Orange
\newcommand{\useAccentDeepOrange}{
    \definecolor{accent}{HTML}{FF3D00}
    \definecolor{textAccent}{HTML}{FFFFFF}
}

% Accent Brown
\newcommand{\useAccentBrown}{
    \definecolor{accent}{HTML}{795548}
    \definecolor{textAccent}{HTML}{FFFFFF}
}

% Accent Grey
\newcommand{\useAccentGrey}{
    \definecolor{accent}{HTML}{9E9E9E}
    \definecolor{textAccent}{HTML}{000000}
}

% Accent Blue Grey
\newcommand{\useAccentBlueGrey}{
    \definecolor{accent}{HTML}{607D8B}
    \definecolor{textAccent}{HTML}{FFFFFF}
}


% more color settings
%\color{block title}{fg=primary}
\hypersetup{linkcolor=primary}
%\color{section in toc}{fg=primary}
%\color{subsection in toc}{fg=primary}


%\template{navigation symbols}{}

%\font*{title}{size=\Huge}
%\font*{frametitle}{size=\large}

\makeatletter

% Correction de la définition de save height
\tcbset{%
  save height/.code={%
    \tcbset{breakable}%
    \edef\@tempa{\noexpand\providecommand{\expandafter\noexpand\csname#1\endcsname}{\the\dimexpr 2cm\relax}}%
    \@tempa
    \def\tcb@split@start{%
      \tcb@breakat@init%
      \tcb@comp@h@page%
      \def\tcb@ch{%
        \tcbset{height=\tcb@h@page}%
        \tcbdimto{\csname#1\endcsname}{\csname#1\endcsname+\tcb@h@page-\tcb@natheight}%
        \immediate\write\@auxout{\string\gdef\expandafter\string\csname#1\endcsname{\csname#1\endcsname}}%
        \tcb@ch%
      }%
      \tcb@drawcolorbox@standalone%
    }%
  }%
}

\makeatother

% tcolorbox settings
\newcommand{\setCardSettings}{%
\tcbset{%
colback=BGgrey04, colbacktitle=primary, coltitle=textPrimary, coltext=text,%
enhanced, sharpish corners=all,%
fuzzy shadow={0mm}{0.9mm}{0.6mm}{0.2mm}{shadow!20!BGgrey03}, % top
fuzzy shadow={0mm}{-0.6mm}{-0.1mm}{0.2mm}{shadow!40!BGgrey03}, % bottomSmall
fuzzy shadow={0mm}{-0.2mm}{-0.2mm}{0.2mm}{shadow!20!BGgrey03}, % bottomBig
left=6mm, right=6mm, top=6mm, bottom=6mm, middle=4mm,%
title filled, boxrule=0mm, %
segmentation code={\path[draw=BGgrey01](segmentation.west) -- (segmentation.east);}%
}
}

\setCardSettings

% Définir l'interligne global à 1,5
\renewcommand{\baselinestretch}{1.1}

% height=\textheight - \topmargin ,breakable=unlimited , save height=\MyHeight 
\newenvironment{card}[1][pR23s2OTKY]{%
  \setCardSettings
    \ifthenelse{\equal{#1}{pR23s2OTKY}}{%
      \begin{tcolorbox}%
    }{%
      \begin{tcolorbox}[colbacktitle=primary, coltitle=textPrimary, fonttitle=\LARGE, title=#1, left=6mm, right=6mm, top=3mm, bottom=4mm, middle=4mm, toptitle=4mm, before skip=20pt, bottomtitle=3mm, width=\textwidth]%
    }%
}{%
  \end{tcolorbox}%
}

\newenvironment{cardTiny}{%
  \setCardSettings
  \begin{tcolorbox}[colbacktitle=primary, left=4mm, right=4mm, top=2mm, bottom=2mm, middle=4mm, toptitle=4mm, bottomtitle=3mm,]%
}{%
  \end{tcolorbox}%
}

\newcommand{\cardImg}[3][pR23s2OTKY]{%
  \setCardSettings
  \ifthenelse{\equal{#1}{pR23s2OTKY}}{%
    \begin{tcolorbox}[lower separated=false, leftupper=0mm, rightupper=0mm, top=0mm, bottom=0mm, middle=1.5mm, boxsep=0mm, width=#3,]%
      \includegraphics[width=\textwidth]{#2}
    \end{tcolorbox}
  }{%
    \begin{tcolorbox}[lower separated=false, leftupper=0mm, rightupper=0mm, top=0mm, middle=1.5mm, boxsep=0mm, leftlower=6mm, rightlower=6mm, bottom=6mm, width=#3,]%
      \includegraphics[width=\textwidth]{#2}
      \tcblower
      #1%
    \end{tcolorbox}
  }%
}

\newenvironment{frameImg}[2][width]{%
  \setCardSettings
  \ifthenelse{\equal{#1}{width}}{%
    \usebackgroundtemplate{\hspace{-0.5\paperwidth}\parbox[c][\paperheight][c]{2\paperwidth}{\centering\includegraphics[width=\paperwidth, keepaspectratio=true]{#2}}}%
  }{%
    \usebackgroundtemplate{\hspace{-0.5\paperwidth}\parbox[c][\paperheight][c]{2\paperwidth}{\centering\includegraphics[height=\paperheight, keepaspectratio=true]{#2}}}%
  }%
  \begin{frame}
}{%  
  \end{frame}
}
